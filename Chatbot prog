package machine

fun main() {
    //makeCoffee()
    //reqIngredients()
    //hasIngredients()
    hasNow()
    currentAction()
}

var hasWater = 400
var hasMilk = 540
var hasCoffee = 120
var hasEmptyCups = 9
var hasMoney = 550
var action = ""

fun hasNow() {
    println("""
    The coffee machine has:
    $hasWater ml of water
    $hasMilk ml of milk
    $hasCoffee g of coffee beans
    $hasEmptyCups disposable cups
    ${'$'}$hasMoney of money    
    """.trimIndent())
    println()
}

fun currentAction() {
    while (action != "exit") {
        println("Write action (buy, fill, take):")
        action = readln()
        when (action) {
            "buy" -> {
                buy()
                action = "exit"
            }
            "fill" -> {
                fill()
                action = "exit"
            }
            "take" -> {
                takeMoney()
                action = "exit"
            }
            else -> action = ""
        }
    }
}

fun buy() {
    println("What do you want to buy? 1 - espresso, 2 - latte, 3 - cappuccino:")
    val num = readln()
    when (num) {
        "1" -> espresso()
        "2" -> latte()
        "3" -> cappuccino()
        else -> buy()
    }
}

fun espresso() {
    if (hasWater - 250 >= 0 && hasCoffee - 16 >= 0 && hasEmptyCups > 0) {
        hasWater -= 250
        hasCoffee -= 16
        hasMoney += 4
        hasEmptyCups--
        println()
        hasNow()
    }
}

fun latte() {
    if (hasWater - 350 >= 0 && hasMilk - 75 >= 0 && hasCoffee - 20 >= 0 && hasEmptyCups > 0) {
        hasWater -= 350
        hasMilk -= 75
        hasCoffee -= 20
        hasMoney += 7
        hasEmptyCups--
        println()
        hasNow()
    }
}

fun cappuccino() {
    if (hasWater - 200 >= 0 && hasMilk - 100 >= 0 && hasCoffee - 12 >= 0 && hasEmptyCups > 0) {
        hasWater -= 200
        hasMilk -= 100
        hasCoffee -= 12
        hasMoney += 6
        hasEmptyCups--
        println()
        hasNow()
    }
}

fun fill() {
    println("Write how many ml of water you want to add:")
    val addWater = readln().toInt()
    hasWater += addWater
    println("Write how many ml of milk you want to add:")
    val addMilk = readln().toInt()
    hasMilk += addMilk
    println("Write how many grams of coffee beans you want to add:")
    val addCoffee = readln().toInt()
    hasCoffee += addCoffee
    println("Write how many disposable cups you want to add:")
    val addEmptyCups = readln().toInt()
    hasEmptyCups += addEmptyCups
    println()
    hasNow()
}

fun takeMoney() {
    println("I gave you \$${hasMoney}")
    hasMoney = 0
    println()
    hasNow()
}

fun makeCoffee() {
    println("""
        Starting to make a coffee
        Grinding coffee beans
        Boiling water
        Mixing boiled water with crushed coffee beans
        Pouring coffee into the cup
        Pouring some milk into the cup
        Coffee is ready!
    """.trimIndent())
}

fun reqIngredients() {
    val numOfCups = readln().toInt()
    val reqWater = 200 * numOfCups
    val reqMilk = 50 * numOfCups
    val reqCoffee = 15 * numOfCups
    println("""
        For $numOfCups cups of coffee you will need:
        $reqWater ml of water
        $reqMilk ml of milk
        $reqCoffee g of coffee beans
    """.trimIndent())
}

fun hasIngredients() {
    println("Write how many ml of water the coffee machine has:")
    val hasWater = readln().toInt()
    val waterEnoughFor = hasWater / 200
    println("Write how many ml of milk the coffee machine has:")
    val hasMilk = readln().toInt()
    val milkEnoughFor = hasMilk / 50
    println("Write how many grams of coffee beans the coffee machine has:")
    val hasCoffee = readln().toInt()
    val coffeeEnoughFor = hasCoffee / 15
    val canMakeCups = minOf(waterEnoughFor, milkEnoughFor, coffeeEnoughFor)

    println("Write how many cups of coffee you will need:")
    val reqCupsOfCoffee = readln().toInt()

    if (reqCupsOfCoffee > canMakeCups) {
        println("No, I can make only $canMakeCups cups of coffee")
    } else if (reqCupsOfCoffee == canMakeCups) {
        println("Yes, I can make that amount of coffee")
    } else {
        println("Yes, I can make that amount of coffee (and even ${canMakeCups - reqCupsOfCoffee} more than that)")
    }
}
